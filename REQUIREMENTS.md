# 要件定義書 - Evanescent Chroma Hexa MVP

## ユースケース駆動の要件抽出

### 前提条件
- GitHub Pagesで静的ホスティング
- ビルドツール不要（Vanilla JS）
- モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版）

---

## コアユースケース

### UC1: ゲームを開始する
**アクター**: プレイヤー
**トリガー**: ページを開く / 新規ゲームボタンをクリック

**フロー**:
1. ページが読み込まれる
2. 六角形グリッドが表示される
3. 各タイルに色がランダムに割り当てられる
4. スコアが0で表示される

**成功条件**: プレイ可能な盤面が表示される

---

### UC2: タイルを選択して消す
**アクター**: プレイヤー
**トリガー**: タイルをクリック

**フロー**:
1. プレイヤーがタイルにマウスオーバー
2. 同じ色で隣接するグループがハイライト（2個以上の場合）
3. プレイヤーがクリック
4. グループが消える
5. スコアが加算される
6. 残ったタイルが下に落ちる
7. 次の操作を待つ

**成功条件**: タイルが消えてスコアが更新される

**代替フロー**:
- 2a. 隣接するタイルがない場合 → 何も起こらない

---

### UC3: ゲーム終了を確認する
**アクター**: システム
**トリガー**: タイル消去後

**フロー**:
1. 盤面をチェック
2. 消せるグループ（同色2個以上の隣接）が存在するか判定
3. 存在しない場合、ゲーム終了状態に移行
4. 最終スコアを表示

**成功条件**: ゲーム終了が正しく判定される

---

## 機能要件（Must Have）

### FR1: 六角形グリッドの描画
- [ ] 六角形タイルをグリッド状に配置できる
- [ ] Pointy-top方式（尖った頂点が上）
- [ ] グリッドサイズ: 8列 × 9行（固定でOK）
- [ ] 各六角形はクリック可能

**実装方式**: CSS `clip-path` + HTML要素

---

### FR2: タイルの初期配置
- [ ] 4色のランダム配置（赤、青、緑、黄）
- [ ] 全てのマスが埋まっている状態でスタート
- [ ] 色の分布は完全ランダム（調整不要）

---

### FR3: 隣接グループの検出
- [ ] クリックされたタイルと同じ色の隣接タイルを検出
- [ ] 六角形の6方向（上下左右斜め）を正しく判定
- [ ] 再帰的にグループ全体を探索（BFS or DFS）
- [ ] グループサイズが2以上の場合のみ消去可能

---

### FR4: グループハイライト
- [ ] マウスオーバー時に消去可能なグループをハイライト表示
- [ ] グループサイズが1の場合はハイライトしない
- [ ] マウスアウト時にハイライトを解除

---

### FR5: タイル消去
- [ ] クリック時にグループ内の全タイルを削除
- [ ] 削除されたタイルは非表示 / DOM削除
- [ ] スコアを計算して加算

---

### FR6: スコア計算
- [ ] 公式: `(n - 2)²` (n = 消したタイル数)
- [ ] スコアを画面に表示
- [ ] 累積スコアとして加算

---

### FR7: 重力処理
- [ ] タイル消去後、上のタイルが下に落ちる
- [ ] **方針**: 縦列単純落下（各列で独立して落下）
- [ ] 空白マスを詰める

**注**: 中心寄せ落下は複雑なのでMVPでは不要

---

### FR8: ゲーム終了判定
- [ ] タイル消去後、全タイルをチェック
- [ ] 同色2個以上の隣接グループが存在するか判定
- [ ] 存在しない場合、ゲーム終了フラグを立てる
- [ ] ゲーム終了メッセージを表示

---

### FR9: 新規ゲームボタン
- [ ] ボタンクリックで盤面をリセット
- [ ] スコアを0にリセット
- [ ] 新しいランダム配置を生成

---

## 非機能要件（Must Have）

### NFR1: パフォーマンス
- [ ] グリッド描画: 1秒以内
- [ ] クリック反応: 100ms以内
- [ ] 重力処理: 500ms以内

### NFR2: 互換性
- [ ] Chrome 最新版で動作
- [ ] Firefox 最新版で動作
- [ ] Safari 最新版で動作（clip-pathサポート確認）

### NFR3: 可読性
- [ ] コードコメント（日本語OK）
- [ ] 関数は単一責任
- [ ] ファイル分割（3-5ファイル程度）

---

## 対象外（Won't Have in MVP）

### 除外する機能
- ❌ アニメーション（フェード、移動）
- ❌ ハイスコア保存
- ❌ Undo機能
- ❌ ヒント機能
- ❌ サウンド
- ❌ 設定画面
- ❌ タイムアタックモード
- ❌ レスポンシブデザイン（デスクトップのみ）
- ❌ 全消しボーナス
- ❌ 大連鎖ボーナス

**理由**: MVPは「動くゲーム」を最速で作ることが目的

---

## 最小限のUI要素

```
+----------------------------------+
|   Evanescent Chroma Hexa         |
+----------------------------------+
| スコア: 123                       |
+----------------------------------+
|                                  |
|      [六角形グリッド]            |
|                                  |
+----------------------------------+
| [新規ゲーム]                      |
+----------------------------------+
```

### 必要なUI
1. タイトル（テキスト）
2. スコア表示（数値）
3. グリッド（六角形タイル）
4. 新規ゲームボタン
5. ゲーム終了メッセージ（オーバーレイまたはalert）

---

## データ構造（最小限）

### タイル
```javascript
{
  q: number,      // 列座標（Axial座標系）
  r: number,      // 行座標
  color: number   // 0-3 (4色)
}
```

### ゲーム状態
```javascript
{
  tiles: Map<string, Tile>,  // key = "q,r"
  score: number,
  gameOver: boolean
}
```

---

## ファイル構成（最小限）

```
/
├── index.html       # HTML + インラインCSS（または外部CSS 1ファイル）
├── game.js          # ゲームロジック全て（300-500行程度）
└── README.md
```

**または分割版**:
```
/
├── index.html
├── style.css
├── hex-utils.js     # 六角形座標変換、隣接判定
├── game.js          # ゲーム状態管理
└── main.js          # 初期化、イベント処理
```

---

## 実装順序

### Phase 1: 描画
1. 六角形を1つ描画（CSS clip-path）
2. グリッドに並べる（座標変換）
3. 色を4色ランダムに割り当て

### Phase 2: インタラクション
4. クリックイベント取得
5. 隣接タイル検出
6. グループ検出（BFS）
7. ハイライト表示

### Phase 3: ゲームロジック
8. タイル消去
9. スコア計算
10. 重力処理（縦列落下）
11. ゲーム終了判定
12. 新規ゲームボタン

---

## 受け入れ基準

### 最小限の「完成」とは
✅ ページを開くとゲームが始まる
✅ タイルをクリックすると消える
✅ スコアが正しく表示される
✅ タイルが下に落ちる
✅ 消せるタイルがなくなったら終了する
✅ 新規ゲームで再スタートできる

---

## 見積もり

### 開発時間（目安）
- 六角形描画システム: 2-3時間
- ゲームロジック: 3-4時間
- UI統合: 1-2時間
- テスト・調整: 2-3時間

**合計**: 8-12時間（初回実装）

---

## 参考

### 必須リソース
- [Red Blob Games - Hexagonal Grids](https://www.redblobgames.com/grids/hexagons/) - 座標系の理解

### 技術選択の根拠
- **CSS clip-path**: 最もシンプル、DOM操作可能
- **縦列落下**: 実装が簡単、MVPに十分
- **4色**: 盤面が簡単すぎず難しすぎず
- **8×9グリッド**: 画面に収まりつつ戦略性あり
