# Evanescent Chroma Hexa 仕様書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Evanescent Chroma Hexa** - 六角形グリッドベースの色合わせパズルゲーム

### 1.2 目的
- GitHub Pagesで無料でプレイ可能
- ブラウザベースの軽量なパズルゲーム
- 従来の四角形グリッドとは異なる戦略性を提供

### 1.3 技術スタック
- **HTML5** - ゲーム構造
- **CSS3** - スタイリングとアニメーション
- **Vanilla JavaScript** - ゲームロジック（ビルド不要）
- **Canvas API** または **SVG** - 六角形の描画
- **GitHub Pages** - ホスティング

---

## 2. ゲームメカニクス

### 2.1 基本ルール

1. **グリッド**
   - 六角形のタイルで構成された盤面
   - 推奨サイズ: 8×9 または 9×10 （調整可能）

2. **色**
   - 4〜6色のカラーパレット
   - 初期配置はランダム

3. **プレイ方法**
   - 同じ色で隣接する2つ以上のタイルグループをクリック
   - グループが消え、スコアを獲得
   - 残ったタイルが下に落下し、隙間を埋める

4. **ゲーム終了条件**
   - 隣接する同色のグループが存在しなくなったら終了
   - 全消しでボーナス

### 2.2 六角形グリッドの特徴

#### 隣接関係
- 各六角形は最大6つの隣接タイルを持つ（四角形は4つ）
- 隣接方向:
  ```
      偶数列              奇数列
       [0]                 [0]
   [5]  H  [1]         [5]  H  [1]
   [4]  [2][3]         [4]  [2][3]
  ```

#### 配置パターン
- **Pointy-top** (尖った頂点が上) または **Flat-top** (平らな辺が上)
- 推奨: **Pointy-top** (視覚的に自然な落下動作)

### 2.3 タイル消去ロジック

```
1. プレイヤーがタイルをクリック
2. 同じ色の隣接タイルを再帰的に検索（BFS/DFS）
3. グループサイズが2以上なら消去可能
4. 消去されたタイルを盤面から削除
5. 重力処理を実行
```

### 2.4 重力処理（六角形版）

六角形グリッドでの落下は複雑：

**方針A: 縦列単純落下**
- 各列で上のタイルが下に落ちる
- 実装が簡単
- 隙間が残りやすい

**方針B: 中心寄せ落下** ⭐推奨
- タイルを下かつ中央に向かって落とす
- より戦略的なゲームプレイ
- 実装は複雑だが、ゲーム性が向上

---

## 3. スコアリングシステム

### 3.1 基本スコア計算

```
スコア = (タイル数 - 2)²
```

| タイル数 | スコア |
|---------|--------|
| 2       | 0      |
| 3       | 1      |
| 4       | 4      |
| 5       | 9      |
| 10      | 64     |
| 20      | 324    |

### 3.2 ボーナス

- **全消しボーナス**: +1000点
- **大連鎖ボーナス**: 10タイル以上 → ×1.5倍
- **残りタイル数ペナルティ**: ゲーム終了時、残りタイル × -5点

---

## 4. UI/UX デザイン

### 4.1 画面レイアウト

```
+----------------------------------+
|    Evanescent Chroma Hexa        |
+----------------------------------+
| スコア: 1234    残り手: ?         |
+----------------------------------+
|                                  |
|        [六角形グリッド]           |
|                                  |
|                                  |
+----------------------------------+
| [新規ゲーム] [設定] [ヘルプ]      |
+----------------------------------+
```

### 4.2 視覚効果

1. **ホバーエフェクト**
   - マウスオーバーで選択可能なグループをハイライト
   - グループサイズと獲得スコアを表示

2. **消去アニメーション**
   - フェードアウト + 縮小（300ms）
   - パーティクルエフェクト（オプション）

3. **落下アニメーション**
   - スムーズな移動（200-400ms）
   - イージング: ease-out

4. **カラーパレット**
   - アクセシビリティを考慮（色覚特性対応）
   - 高コントラスト
   - 推奨色:
     - 赤 `#FF6B6B`
     - 青 `#4ECDC4`
     - 緑 `#95E1D3`
     - 黄 `#FFE66D`
     - 紫 `#A8E6CF`
     - オレンジ `#FFA07A`

### 4.3 レスポンシブデザイン

- デスクトップ: 800×600px以上
- タブレット: タッチ操作対応
- モバイル: 縦画面最適化

---

## 5. 機能要件

### 5.1 Phase 1: MVP (最小viable製品)

- [x] 六角形グリッドの描画
- [x] ランダムな初期配置
- [x] クリックによるタイル消去
- [x] 基本スコア計算
- [x] 重力処理
- [x] ゲーム終了判定

### 5.2 Phase 2: 機能拡張

- [ ] アニメーション
- [ ] ハイスコア保存（LocalStorage）
- [ ] Undo機能
- [ ] ヒント表示
- [ ] 設定画面（グリッドサイズ、色数）

### 5.3 Phase 3: 高度な機能

- [ ] ゲームモード選択
  - クラシック（時間制限なし）
  - タイムアタック
  - パズルモード（固定盤面）
- [ ] サウンドエフェクト
- [ ] リーダーボード（オプション）
- [ ] PWA対応（オフラインプレイ）

---

## 6. データ構造

### 6.1 六角形座標系

**Axial座標系** を使用（推奨）

```javascript
// 六角形の位置
{
  q: number,  // 列
  r: number   // 行
}

// 隣接タイルの取得
const neighbors = [
  {dq: +1, dr:  0}, {dq: +1, dr: -1}, {dq:  0, dr: -1},
  {dq: -1, dr:  0}, {dq: -1, dr: +1}, {dq:  0, dr: +1}
];
```

### 6.2 ゲーム状態

```javascript
{
  grid: Array<Array<Tile>>,  // 盤面
  score: number,              // 現在のスコア
  moves: number,              // 手数
  gameOver: boolean,          // ゲーム終了フラグ
  history: Array<GameState>   // Undo用
}

// Tile
{
  q: number,
  r: number,
  color: number,  // 0-5
  id: string      // ユニークID
}
```

---

## 7. ファイル構造

```
/
├── index.html          # メインHTML
├── css/
│   ├── style.css      # 全体スタイル
│   └── hexagon.css    # 六角形スタイル
├── js/
│   ├── main.js        # エントリーポイント
│   ├── game.js        # ゲームロジック
│   ├── hex.js         # 六角形ユーティリティ
│   ├── renderer.js    # 描画処理
│   └── ui.js          # UI制御
├── assets/
│   └── sounds/        # サウンドエフェクト（オプション）
├── README.md
└── SPEC.md            # この仕様書
```

---

## 8. 実装優先順位

### 優先度: 高
1. 六角形グリッドの描画システム
2. タイル配置とランダム生成
3. クリック検出と隣接判定
4. タイル消去ロジック
5. 基本的な重力処理

### 優先度: 中
6. スコアリングシステム
7. ゲーム終了判定
8. 基本アニメーション
9. UI/UXの改善

### 優先度: 低
10. ハイスコア保存
11. Undo機能
12. サウンドエフェクト
13. 高度なゲームモード

---

## 9. 技術的課題と解決策

### 9.1 六角形の描画

**選択肢A: Canvas API**
- 利点: 高パフォーマンス、アニメーション制御が容易
- 欠点: DOM操作ができない

**選択肢B: SVG**
- 利点: DOM操作可能、スケーラブル
- 欠点: 大量の要素でパフォーマンス低下

**選択肢C: CSS Grid + clip-path** ⭐推奨
- 利点: HTMLとの統合が容易、イベント処理が簡単
- 欠点: ブラウザ互換性に注意

### 9.2 六角形座標変換

Axial座標からピクセル座標への変換:

```javascript
function hexToPixel(q, r, size) {
  const x = size * (3/2 * q);
  const y = size * (Math.sqrt(3)/2 * q + Math.sqrt(3) * r);
  return { x, y };
}
```

---

## 10. テスト計画

### 10.1 手動テスト項目

- [ ] 全ての隣接パターンで正しくグループ検出
- [ ] 異なるグリッドサイズで動作
- [ ] スコア計算が正確
- [ ] 重力処理後に隙間がない
- [ ] ゲーム終了判定が正確

### 10.2 ブラウザ互換性

- Chrome (最新版)
- Firefox (最新版)
- Safari (最新版)
- Edge (最新版)

---

## 11. リリース計画

### v0.1.0 - MVP
- 基本的なゲームプレイ可能
- シンプルなUI

### v0.2.0 - Polish
- アニメーション追加
- UI/UX改善
- ハイスコア保存

### v1.0.0 - Full Release
- 全機能実装
- 十分なテスト完了
- ドキュメント整備

---

## 12. 参考資料

### 六角形グリッド
- [Red Blob Games - Hexagonal Grids](https://www.redblobgames.com/grids/hexagons/)

---

## 更新履歴

- 2025-10-25: 初版作成
